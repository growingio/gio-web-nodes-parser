!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GioWebNodesParser={})}(this,(function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,i=1,n=arguments.length;n>i;i++)for(var r in t=arguments[i])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},t.apply(this,arguments)};function i(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}function r(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;o>r;r++)!n&&r in t||(n||(n=[].slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||[].slice.call(t))}function o(e){return[].slice.call(e)}function a(e){try{return e()}catch(e){return}}function s(e,t){return function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}(e)===t}function u(e){return s(e,"number")}function l(e){return s(e,"object")&&!function(e){return s(e,"undefined")||s(e,"null")}(e)}function c(e){return Array.isArray(e)&&s(e,"array")}function d(e,t){return e[f(e,t,!1)]}function f(e,t,i){void 0===i&&(i=!1);var n=-1;if(c(e))for(var r=i?e.length-1:0,o=i?0:e.length-1,a=i?-1:1,s=r;i?s>=o:o>=s;s+=a)if(t(e[s])&&(n=s,!i))return n;return n}function h(e,t){return!(!c(e)&&!function(e){return s(e,"string")}(e)||0>e.indexOf(t))}function v(e){return l(e)?Object.keys(e):[]}function g(e){return c(e)?0===e.length:l(e)?0===v(e).length:!e}"function"==typeof SuppressedError&&SuppressedError;var p=["script","style","meta","link","title"],m=r(r(r(r([],n(p),!1),n(["html","head","body","base","noscript"]),!1),n(["defs","g","path","circle","rect","line","polygon","polyline","ellipse","text","tspan","use"]),!1),n(["area","audio","br","canvas","col","colgroup","embed","hr","iframe","map","object","param","source","track","video","wbr"]),!1),_=["button","reset","submit"],N=r(r([],n(_),!1),["file"],!1),y=["checkbox","color","radio","range"],w=r(r([],n(y),!1),["date","datetime-local","email","month","number","password","text","time","week"],!1),b=["tr","li","dt","dd"],L=r(["a","button","dl"],n(b),!1),x=["i","em","svg","img"],E=["i","span","em","b","strong","bdo"],C=/(^| |[^ ]+-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^. ]*/g,k=/^([a-zA-Z0-9_-]+)$/,I="data-growing-ignore",T="data-growing-container",P="data-growing-index",S="data-growing-title",M=["circle-shape","circle-page","heatmap-page"],O=["__vconsole","__giokit"],j="DISPLAYED",A="OBSCURED",H="OUTSIDE",D={static:1,relative:2,sticky:3,absolute:4,fixed:5},X=function(e,t){var i;return null!==(i=a((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==i?i:a((function(){return e.hasOwnProperty(t)}))},W=function(e,t){var i;if(!e)return null;var n=null!==(i=a((function(){return e.getAttribute(t)})))&&void 0!==i?i:a((function(){var i,n;return null===(n=null===(i=e.attributes)||void 0===i?void 0:i.getNamedItem(t))||void 0===n?void 0:n.value}));return null!=n?n:null},G=function(e,t){var i;if(!(e instanceof HTMLElement||e instanceof Element))return!1;if(X(e,I))return!1;var o=null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase();if(!o||h(m,o))return!1;if(!h(["circleClick","circleHover","click"],t))return!0;if("textarea"===o&&"click"===t)return!1;if("input"===o){var a=W(e,"type");if("click"===t&&!h(N,a))return!1;if(h(["circleClick","circleHover"],t)&&!h(r(r([],n(N),!1),n(w),!1),a))return!1}return Z(e)||!function(e){var t;if(!(null==e?void 0:e.children))return!1;if("svg"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase()))return!1;var i=e.children.length;if(0===i)return!1;for(var r=[],o=0;i>o;o++)r.push([e.children[o],1]);for(;r.length>0;){var a=n(r.shift(),2),s=a[0],u=a[1];if(u>5)return!0;var l=s.children.length;if(l>0&&u+1>5)return!0;for(o=0;l>o;o++)r.push([s.children[o],u+1])}return!1}(e)},V=function(e,t){if(void 0===t&&(t=!1),!(null==e?void 0:e.childNodes))return[];var i=t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE];return o(e.childNodes).filter((function(e){var t;if(!h(i,e.nodeType))return!1;if(e.nodeType===Node.TEXT_NODE)return!0;var n=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();return!!n&&!h(m,n)}))},z=function(e){return B(e.parentElement)?null:e.parentElement},B=function(e){var t;return!e||h(["body","html","#document"],null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())},Z=function(e){if(!(null==e?void 0:e.tagName))return!1;var t=e.tagName.toLowerCase();return X(e,T)||h(L,t)||"input"===t&&h(_,e.type)},R=function(e){var t=V(e);return!g(t)&&t.every((function(e){var t,i=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();return!!i&&(h(x,i)||h(o(e.classList),"icon"))&&!q(e)}))},q=function(e){var t=V(e,!0);return!g(t)&&t.every((function(e){var t;return(e.nodeType===Node.TEXT_NODE||h(E,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase()))&&!!U(e)}))},F=function(e){if("svg"===e.tagName)return!0;var t=V(e),i=q(e);return g(t)||i},U=function(e){var t=V(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||h(E,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return $(e.textContent,e.textContent.length)}));return $(function(e){if(c(e)){for(var t=[],i=0;i<e.length;i++){var n=e[i];n&&!g(n)&&t.push(n)}return t}return e}(t).join(" "))},$=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,u(t)&&t>0?t:void 0):""};function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}var Y=function(e,t){for(var i=0;i<e.length;i++){if((n=e[i])===(r=t)||n!=n&&r!=r)return i}var n,r;return-1},J=function(){function e(){"undefined"!=typeof WeakMap&&(this._wm=new WeakMap),this._id="_weakmap_"+Math.random().toString(36).substr(2,9)}return e.prototype.set=function(e,t){if("object"!==K(e)||null===e)throw new TypeError("Invalid value used as weak map key");return this._wm?(this._wm.set(e,t),this):(Object.defineProperty(e,this._id,{value:t,configurable:!0}),this)},e.prototype.get=function(e){if("object"===K(e)&&null!==e)return this._wm?this._wm.get(e):e[this._id]},e.prototype.has=function(e){return"object"===K(e)&&null!==e&&(this._wm?this._wm.has(e):this._id in e)},e.prototype.delete=function(e){return"object"===K(e)&&null!==e&&(this._wm?this._wm.delete(e):this._id in e&&(delete e[this._id],!0))},e}(),Q=function(){function e(e){if(this._values=[],"undefined"==typeof Set){if(e)for(var t=0;t<e.length;t++)this.add(e[t])}else this._set=new Set(e)}return e.prototype.add=function(e){return this._set?(this._set.add(e),this):(-1===Y(this._values,e)&&this._values.push(e),this)},e.prototype.has=function(e){return this._set?this._set.has(e):-1!==Y(this._values,e)},e.prototype.delete=function(e){if(this._set)return this._set.delete(e);var t=Y(this._values,e);return-1!==t&&(this._values.splice(t,1),!0)},e.prototype.clear=function(){this._set?this._set.clear():this._values=[]},Object.defineProperty(e.prototype,"size",{get:function(){return this._set?this._set.size:this._values.length},enumerable:!1,configurable:!0}),e.prototype.forEach=function(e){var t=this;if(this._set)this._set.forEach((function(i){return e(i,i,t)}));else for(var i=0;i<this._values.length;i++)e(this._values[i],this._values[i],this)},e}(),ee=function(){function e(e){if(this._keys=[],this._values=[],"undefined"==typeof Map){if(e)for(var t=0;t<e.length;t++)this.set(e[t][0],e[t][1])}else this._map=new Map(e)}return e.prototype.set=function(e,t){if(this._map)return this._map.set(e,t),this;var i=Y(this._keys,e);return-1!==i?this._values[i]=t:(this._keys.push(e),this._values.push(t)),this},e.prototype.get=function(e){if(this._map)return this._map.get(e);var t=Y(this._keys,e);return-1!==t?this._values[t]:void 0},e.prototype.has=function(e){return this._map?this._map.has(e):-1!==Y(this._keys,e)},e.prototype.delete=function(e){if(this._map)return this._map.delete(e);var t=Y(this._keys,e);return-1!==t&&(this._keys.splice(t,1),this._values.splice(t,1),!0)},e.prototype.clear=function(){this._map?this._map.clear():(this._keys=[],this._values=[])},Object.defineProperty(e.prototype,"size",{get:function(){return this._map?this._map.size:this._keys.length},enumerable:!1,configurable:!0}),e.prototype.forEach=function(e){var t=this;if(this._map)this._map.forEach((function(i,n){return e(i,n,t)}));else for(var i=0;i<this._keys.length;i++)e(this._values[i],this._keys[i],this)},e}(),te=/[^/]*\.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,ie=function(e,t){if(!t)return["",""];switch(t.toLowerCase()){case"a":return function(e){if(!X(e,"href"))return["",""];var t=W(e,"href");return!t||/^\s*javascript\s*:/i.test(t)?["",""]:t.length>320?[t.slice(0,320),t]:[t,t]}(e);case"img":return function(e){var t,i=e.src;if(!i||h(i,"data:image"))return["",""];var n=i.match(te),r=null!==(t=null==n?void 0:n[0])&&void 0!==t?t:"";return h(r,"%")&&(r=r.substring(r.lastIndexOf("%")+3)),i.length>320?[i.slice(0,320),r]:[i,r]}(e);default:return["",""]}},ne={a:function(e){var t=U(e);return t||(ue(e)||ie(e,"a")[0])},button:function(e){var t=W(e,"name");if(t)return t;var i=U(e);return i||(ue(e)||le(e))},img:function(e){return $(W(e,"alt"))||ie(e,"img")[1]},input:function(e){if("password"===e.type)return"";var t=h(N,e.type),i=X(e,"data-growing-track");if(t||i)return $(e.value);if(h(y,e.type)){var n=void 0;return e.id&&(n=d(o(document.getElementsByTagName("label")),(function(t){return t.htmlFor===e.id}))),n||(n=se(e,(function(e){var t;return"label"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())}))),ce(e,n?U(n):$(e.value))}return""},label:function(e){var t=U(e);return t||(ue(e)||le(e))},select:function(e){var t=o(e.options).filter((function(e){return e.selected}));if(t.length>0){var i=t.map((function(e){return e.hasAttribute("label")&&e.label&&e.label.trim()?e.label:e.textContent&&e.textContent.trim()?e.textContent.trim():e.value||""}));return $(i.join(", "))}return $(e.value)},svg:function(e){var t;return o(e.childNodes).some((function(e){var i;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},re=new J,oe=function(e,t){var i=t.toLowerCase(),n=i in ne?ne[i]:void 0;if(!n&&re.has(e))return re.get(e);var r=W(e,S);if(X(e,S)&&r){var o=$(r);return re.set(e,o),o}var a=W(e,"title");if(X(e,"title")&&a)return o=$(a),re.set(e,o),o;if(n)return n(e);var s=U(e);return s?(o=$(s),re.set(e,o),o):function(e){if("svg"===e.tagName)return!1;var t=V(e);return t.length>0&&t.every(F)}(e)&&!R(e)?(o=$(ue(e)),re.set(e,o),o):R(e)?(o=$(le(e)),re.set(e,o),o):(re.set(e,""),"")},ae=new J,se=function(e,t){if(ae.has(e))return ae.get(e);for(var i=e.parentElement;i&&!B(i);){if(t(i))return ae.set(e,i),i;var n=i.parentElement;if(!n)break;i=n}ae.set(e,void 0)},ue=function(e){for(var t=V(e),i=[],n=0,r=t.length;r>n;n++){var o=t[n];if(q(o)){var a=U(o);if(a&&(i.push(a),i.join(" ").length>100))break}}return i.join(" ").slice(0,100)},le=function(e,t){var i;if(void 0===t&&(t=0),3>=t)for(var n=V(e),r=0,o=n.length;o>r;r++){var a=n[r],s=oe(a,null===(i=a.tagName)||void 0===i?void 0:i.toLowerCase());if(s)return s;var u=le(a,t+1);if(u)return u;if(r>5&&0===t)break}},ce=function(e,t){return h(["checkbox","radio"],e.type)?"".concat(t).concat(s(e.checked,"boolean")?"("+e.checked+")":""):t},de=function(){function e(t,a,s,u,l,c){void 0===u&&(u=!0),void 0===l&&(l=[]),void 0===c&&(c=!1);var v,p,m,N=this;this.originNode=t,this.deviceInfo=a,this.actionType=s,this.isTrackable=u,this.parentNodes=l,this.silentMode=c,this.isMarkedIndex=!1,this.isLimitViewport=!0,this._pureList=[],this._pseudoList=[],this._warn=function(e){N.silentMode||console.log("%c [GrowingIO]：".concat('index标记值 "'.concat(e,'" 不合法，应为大于0且小于2147483647的整数！')),"color: #F59E0B;")},this._checkGioIndex=function(){var e=W(N.originNode,P);if(e)if(/^\d{1,10}$/.test(e)){var t=+e;if(t>0&&2147483647>t)return t;N._warn(t)}else N._warn(e)},this._getDlIndex=function(){var e,t,i,n=z(N.originNode);if(n&&n.tagName&&"dl"===n.tagName.toLowerCase()){var r=o(n.children).filter((function(e){return e.nodeType===Node.ELEMENT_NODE}));if(0!==r.length){var a=new ee,s=0;if(r.forEach((function(e){var t;"dt"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())&&a.set(e,++s)})),"dt"===(null===(e=N.originNode.tagName)||void 0===e?void 0:e.toLowerCase()))return a.get(N.originNode)||void 0;if("dd"!==(null===(t=N.originNode.tagName)||void 0===t?void 0:t.toLowerCase()));else for(var u=r.indexOf(N.originNode);u>=0;){var l=r[u];if("dt"===(null===(i=l.tagName)||void 0===i?void 0:i.toLowerCase()))return a.get(l)||void 0;u--}}}},this._getListIndex=function(e){var t=f(e,(function(e){return e.isSameNode(N.originNode)}));if(t>-1)return t+1},this._getIndex=function(){if(X(N.originNode,P))return N.isMarkedIndex=!0,N._checkGioIndex();if(N.tagName&&h(["dd","dt"],N.tagName.toLowerCase())){var e=N._getDlIndex();if(void 0!==e)return e}if(N.isPureList&&N._pureList){var t=N._getListIndex(N._pureList);if(void 0!==t)return t}if(N.isPseudoList&&N._pseudoList){var i=N._getListIndex(N._pseudoList);if(void 0!==i)return i}},this._isListNode=function(e){return e&&e.nodeType===Node.ELEMENT_NODE&&e.tagName&&h(b,e.tagName.toLowerCase())},this._getIsPureList=function(){if(N._pureList=[],!N._isListNode(N.originNode))return!1;for(var e=[],t=N.originNode.previousElementSibling;t&&N._isListNode(t);)e.unshift(t),t=t.previousElementSibling;e.push(N.originNode);for(var i=N.originNode.nextElementSibling;i&&N._isListNode(i);)e.push(i),i=i.nextElementSibling;return N._pureList=e,e.length>=2},this._getIsPseudoList=function(){var e=N._getSiblings(N.originNode);if(3>e.length)return!1;var t=N._findLongestUniformSequence(N.originNode,e);return t.length>=3&&(N._pseudoList=t.filter((function(e){return e instanceof Element})),N._pseudoList.length>=3)},this._getClassList=function(e){var t,n,r=W(e,"name");if(X(e,"name")&&r)return[r];var o=W(e,"class");if(!o)return[];var a=o.split(/\s+/);if(g(a))return[];var s=[];try{for(var u=i(a),l=u.next();!l.done;l=u.next()){var c=l.value;c&&!C.test(c)&&k.test(c)&&s.push(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return s.sort()},this._getCurrentXpath=function(){var e=["/",N.tagName];return N.id&&e.push("#".concat(N.id)),N.classList.length&&e.push(".",N.classList.join(".")),e.join("")},this._getIsContainer=(p=new Q(L),m=new Q(_),function(){return!!X(N.originNode,T)||!!p.has(N.tagName)||!("input"!==N.tagName||!m.has(N.originNode.type))}),this._getIsOutFlow=function(){return h(["fixed","sticky"],window.getComputedStyle(N.originNode).position)},this._getRect=function(){var e=N.originNode.getBoundingClientRect(),t=window.devicePixelRatio||1,i=window.getComputedStyle(N.originNode).transform,n=i&&"none"!==i,r=Math.round(e.top*t)/t,o=Math.round(e.left*t)/t,a=Math.round(e.width*t)/t,s=Math.round(e.height*t)/t;n&&(a=N.originNode.offsetWidth,s=N.originNode.offsetHeight);var u=N.deviceInfo,l=u.winHeight,c=u.winWidth;return{top:r=Math.max(0,Math.min(r,l)),left:o=Math.max(0,Math.min(o,c)),width:a=Math.max(0,Math.min(a,c-o)),height:s=Math.max(0,Math.min(s,l-r))}},this._getListItemViewStatus=function(){var e=d(N.parentNodes,(function(e){var t=e.originNode;return t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth}));if(!e)return"";if(!e.rect)return"";var t=e.rect,i=t.top,n=t.left,r=t.width,o=t.height,a=N.rect,s=a.top,u=a.left,l=n+r,c=i+o,f=u+a.width,h=s+a.height;return i>h||u>l||s>c||n>f?H:i>s||n>u||h>c||f>l?A:j},this._getViewStatus=function(e){var t,r,o,a,s=N,u=s.originNode,l=s.rect,c=s.isPureList,d=s.isPseudoList,f=s.isLimitViewport,h=l.top,v=l.left,g=l.width,p=l.height,m=N.deviceInfo,_=m.winWidth,y=m.winHeight,w=window.getComputedStyle(u);if(0===Number(w.opacity)||"hidden"===w.visibility||"none"===w.display||0===u.offsetWidth||0===u.offsetHeight)return"HIDDEN";try{for(var b=i(e),L=b.next();!L.done;L=b.next()){var x=L.value;if(x.isTrackable&&x.viewStatus===j)return x.viewStatus}}catch(e){t={error:e}}finally{try{L&&!L.done&&(r=b.return)&&r.call(b)}finally{if(t)throw t.error}}if(c||d){var E=N._getListItemViewStatus();if(E)return E}if(!(y>h&&_>v&&g>0&&p>0))return H;var C=[[v+1,h+1],[v+g-1,h+1],[v+1,h+p-1],[v+g-1,h+p-1],[v+g/2,h+p/2]];try{for(var k=i(C),I=k.next();!I.done;I=k.next()){var T=n(I.value,2),P=T[0],S=T[1];if(document.elementFromPoint(P,S)===u)return j}}catch(e){o={error:e}}finally{try{I&&!I.done&&(a=k.return)&&a.call(k)}finally{if(o)throw o.error}}return f&&(0>h+p||0>v+g)?H:A},this._getTriggerEvent=function(){return"change"===N.actionType||"input"===N.tagName&&h(w,N.originNode.type)||h(["select","textarea"],N.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,i){if(i.length>0)return r([],n(i),!1);for(var o=[],a=t.parentElement;a&&!B(a);)o.push(a),a=a.parentElement;return o.map((function(t){if(e.xNodeCache.has(t))return e.xNodeCache.get(t);var i=new e(t,void 0,N.actionType,G(t,N.actionType),[],N.silentMode);return e.xNodeCache.set(t,i),i}))},this.tagName=(t.tagName||"").toLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=X(this.originNode,I),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=!this.isPureList&&this._getIsPseudoList(),this.peerNodes=this.isPureList?this._pureList:this.isPseudoList?this._pseudoList:[],this.index=this._getIndex();var y=ie(t,this.tagName)[0];this.hyperlink=y||null,this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),a&&(this.isLimitViewport=null===(v=a.isLimitViewport)||void 0===v||v,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(l)),this.xParents=this._getXParents(t,l)}return Object.defineProperty(e.prototype,"content",{get:function(){return oe(this.originNode,this.tagName)},enumerable:!1,configurable:!0}),e.prototype._findLongestUniformSequence=function(e,t){for(var i=[],n=[],r=!1,o=-1,a=0;a<t.length;a++){var s=t[a],u=!1;s===e?(u=!0,r=!0):u=this._compareNodes(e,s),u?0===n.length||o===a-1?(n.push(s),o=a):(this._updateMaxSequenceIfBetter(n,i,r),n=[s],r=s===e,o=a):(this._updateMaxSequenceIfBetter(n,i,r),n=[],r=!1,o=-1)}return this._updateMaxSequenceIfBetter(n,i,r),3>i.length?[]:i},e.prototype._updateMaxSequenceIfBetter=function(e,t,i){e.length>t.length&&i&&(t.length=0,t.push.apply(t,r([],n(e),!1)))},e.prototype._getSiblings=function(e){return e instanceof Element?e.parentNode?o(e.parentNode.children).filter((function(e){return e instanceof Element})):[e]:[]},e.prototype._compareNodes=function(e,t,i){var n,r;if(void 0===i&&(i=1),i>4)return!0;if(!(e instanceof Element&&t instanceof Element))return e===t;if(((null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())||"")!==((null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase())||""))return!1;var a=this._getClassList(e),s=this._getClassList(t);if(!this._compareArrays(a,s))return!1;if(e.getAttribute("type")!==t.getAttribute("type"))return!1;var u=o(e.children),l=o(t.children);if(u.length!==l.length)return!1;for(var c=0;c<u.length;c++){var d=u[c],f=l[c];if(!this._compareNodes(d,f,i+1))return!1}return!0},e.prototype._compareArrays=function(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))},e.xNodeCache=new J,e}(),fe=function(){function e(t,i,o,a,s,l){void 0===l&&(l=!1);var c=this;this.origin=t,this.action=i,this.lengthThreshold=o,this.deviceInfo=a,this.parentNode=s,this.silentMode=l,this.updateNodesIndex=function(e,t){e.length&&u(t)&&e.forEach((function(e){var i=e.isMarkedIndex,n=e.isPureList;i||n||(e.index=t)}))},this.trackNodes=function(){if(!c.isTrackable)return[];var e=[c.xNode],t=h(["circleHover","circleChange","change"],c.actionType),i=function(e,t){if("circleClick"!==t)return!1;if(!(null==e?void 0:e.tagName)||"input"!==e.tagName.toLowerCase())return!1;var i=W(e,"type")||"text";return h(w,i)}(c.originElement,c.actionType);if(!t&&!i)for(var n=c._getParent();n;){var r=n.xNode;if(!r||r.isIgnored)return[];n.isTrackable&&e.push(r),n=n._getParent()}for(var o=[],a=0,s=0;s<e.length;s++){var u=e[s],l=0===s;if(X(u.originNode,T)){o.unshift(c.getGioNodeInfo(u)),c.updateNodesIndex(o,u.index);break}var d=u.isContainer||u.isPureList||u.isPseudoList;(l||d&&1>a)&&(o.unshift(c.getGioNodeInfo(u)),d&&(c.updateNodesIndex(o,u.index),l||a++))}return o},this.getGioNodeInfo=function(t){var i;if(e.nodeInfoCache.has(t))return e.nodeInfoCache.get(t);var n=c.computeXpath(t),r=n.skeleton,o={skeleton:r,xpath:r,fullXpath:n.fullXpath,xcontent:n.xcontent,hyperlink:t.hyperlink,index:t.index,peerNodes:null!==(i=t.peerNodes)&&void 0!==i?i:[],content:$(t.content),triggerEvent:t.triggerEvent,originNode:t.originNode,isMarkedIndex:t.isMarkedIndex,isPseudoList:t.isPseudoList,isPureList:t.isPureList,isContainer:t.isContainer};return e.nodeInfoCache.set(t,o),o},this.computeXpath=function(t){var i,o=e.xpathCache.get(t);if(o)return o;var a="/".concat(t.tagName),s=(t.id?"#".concat(t.id):"")+(g(t.classList)?"":".".concat(t.classList.join("."))),u=[a],l=["/".concat(s||"-")],d=[a+s];if(null===(i=t.xParents)||void 0===i?void 0:i.length){for(var f=[],h=[],v=0;v<t.xParents.length;v++){var p=t.xParents[v],m="/".concat(p.tagName),_=(p.id?"#".concat(p.id):"")+(g(p.classList)?"":".".concat(p.classList.join("."))),N=m+_;d.unshift(N),v<c.xpathThreshold-1&&(f.unshift(m),h.unshift("/".concat(_||"-")))}u.unshift.apply(u,r([],n(f),!1)),l.unshift.apply(l,r([],n(h),!1))}var y={skeleton:u.join(""),fullXpath:d.join(""),xcontent:l.join("")};return e.xpathCache.set(t,y),y},this._getParent=function(){var t=z(c.originElement);if((null==t?void 0:t.nodeName)&&!B(t)){if(e.parentCache.has(t)){var i=e.parentCache.get(t);if(i.originElement.id===t.id&&i.originElement.className===t.className)return i;e.parentCache.delete(t)}var n=new e(t,c.actionType,void 0,void 0,void 0,c.silentMode);return e.parentCache.set(t,n),n}},this.actionType=h(["circleClick","circleChange","circleHover","click","change"],i)?i:"click";var d=this.silentMode||h(["circleClick","circleChange","circleHover"],this.actionType),f=n(function(e,t){var i;if(void 0===t&&(t=20),!e)return[e,!1];for(var n=e,r=0,o=!1;n&&t>r;){r++;var a=null===(i=n.tagName)||void 0===i?void 0:i.toLowerCase();if(!a)break;if(!h(m,a)){if(h(E,a)){if(!n.childNodes.length)return[n,o];for(var s=!0,u=0;u<n.childNodes.length;u++){var l=n.childNodes[u];if(l.nodeType!==Node.COMMENT_NODE&&l.nodeType!==Node.TEXT_NODE){s=!1;break}}if(s){var c=z(n);if(c){n=c,o=!0;continue}}}return[n,o]}var d=z(n);if(!d)break;n=d}return[n,o]}(t),2),v=f[0],p=f[1];this.originElement=v,this.isUpgrade=p,this.xpathThreshold=u(o)?o:4,this.isTrackable=G(this.originElement,this.actionType),this.originElement.isSameNode(t)||(s=null);var _=[];s&&s.xNode&&(_.push(s.xNode),s.xNode.xParents&&_.push.apply(_,r([],n(s.xNode.xParents),!1))),this.xNode=new de(this.originElement,this.deviceInfo,this.actionType,this.isTrackable,_,d)}return e.nodeInfoCache=new J,e.xpathCache=new J,e.parentCache=new J,e}(),he=function(){function e(i,o){void 0===o&&(o=4);var a,s,l,c,d,f,m,_=this;this.elements=[],this._processedNodes=new Q,this.trackNodes=function(e,t,i){void 0===t&&(t=[]),void 0===i&&(i=!1),_.elements=[],_._processedNodes.clear();var n=Array.isArray(t)?t:t&&"object"===K(t)?[t]:[];return _._getTrackElements(e,n,null,i,void 0),_.elements},this._shouldProcessNode=function(e){var t;if(!(e instanceof HTMLElement||e instanceof Element))return!1;var i=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();if(!i)return!1;if(h(p,i))return!1;if(e.hasAttribute(I))return!1;if("input"===i){var o=e.getAttribute("type")||"text";return h(r(r([],n(N),!1),n(w),!1),o)}return!0},this._getTrackElements=function(e,t,i,o,a){void 0===o&&(o=!1),V(e).forEach((function(e){var s,l=null===(s=null==e?void 0:e.tagName)||void 0===s?void 0:s.toLowerCase(),c=(null==e?void 0:e.id)||"";if(l&&!h(r([],n(M),!1),l)&&!O.some((function(e){return h(c,e)}))){var d,f=!g(V(e)),v=_._shouldProcessNode(e),p=!!(null==(d=e)?void 0:d.tagName)&&h(x,d.tagName.toLowerCase());if(v||f||p){var m=new fe(e,function(e){var t,i;if("input"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())){var o=(null===(i=e.type)||void 0===i?void 0:i.toLowerCase())||"text";return h(r([],n(w),!1),o)?"change":"click"}return"click"}(e),_.xpathThreshold,_.deviceInfo,i,!0),N=m.xNode;if(N.zLevel=_._getZLevel(e,t[0]),h([j,A],N.viewStatus)||o){var y=_._processedNodes.has(e),b=N.isContainer||N.isPureList||N.isPseudoList;if(m.isTrackable&&!y&&(o||N.viewStatus===j||N.viewStatus===A&&N.isContainer)){var L=_._getGioHybridNodeInfo(m,t);void 0===a||L.isMarkedIndex||L.isPureList||"click"!==m.actionType||(L.index=a),_.elements.push(L),_._processedNodes.add(e)}if((!N.isContainer||!q(e))&&!p&&f){var E=a;m.isTrackable&&b&&u(N.index)&&(E=N.index);var C=r([N],n(t),!1);_._getTrackElements(e,C,m,o,E)}}}}}))},this._getZLevel=function(t,i){var n=window.getComputedStyle(t),r=n.position,o=n.zIndex,a="auto"===o?0:parseInt(o,10)||0,s=(null==i?void 0:i.zLevel)||0;return 0!==a?s+a:s+e.getPositionZLevelIncrement(r)},this._scaleAndOffsetRect=function(e){var t={};return v(e).forEach((function(i){t[i]=e[i]*_.deviceInfo.scale})),t.top+=_.deviceInfo.webviewTop,t.left+=_.deviceInfo.webviewLeft,t},this._getGioHybridNodeInfo=function(e,i){var n=e.xNode,r=n.rect,o=n.zLevel,a=e.getGioNodeInfo(n),s=a.hyperlink,u=_._scaleAndOffsetRect(r),l=i[0];return t(t(t({},u),a),{zLevel:o+_.deviceInfo.webviewZLevel,href:s,parentXPath:(null==l?void 0:l.isTrackable)?e.computeXpath(l).fullXpath:void 0})},this.xpathThreshold=o,this.deviceInfo=(s=(a=i).webviewLeft,l=a.webviewTop,c=a.webviewWidth,d=a.webviewHeight,f=a.webviewZLevel,m=a.isLimitViewport,{winWidth:c,winHeight:d,scale:c/window.innerWidth,webviewTop:l,webviewLeft:s,webviewWidth:c,webviewHeight:d,webviewZLevel:f,isLimitViewport:m})}return e.getPositionZLevelIncrement=function(e){return D[e]||1},e}();e.GioHybridNode=he,e.GioWebNode=fe}));
//# sourceMappingURL=index.umd.js.map
