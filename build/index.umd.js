!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GioWebNodesParser={})}(this,(function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},t.apply(this,arguments)};function n(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function r(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}function o(e){return[].slice.call(e)}function a(e){try{return e()}catch(e){return}}function s(e,t){return function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}(e)===t}function u(e){return s(e,"number")}function l(e){return s(e,"object")&&!function(e){return s(e,"undefined")||s(e,"null")}(e)}function c(e){return Array.isArray(e)&&s(e,"array")}function d(e,t){return!(!c(e)&&!function(e){return s(e,"string")}(e)||0>e.indexOf(t))}function f(e){return l(e)?Object.keys(e):[]}function h(e){return c(e)?0===e.length:l(e)?0===f(e).length:!e}"function"==typeof SuppressedError&&SuppressedError;var v=["script","style","meta","link","title"],g=r(r(r(r([],i(v),!1),i(["html","head","body","base","noscript"]),!1),i(["defs","g","path","circle","rect","line","polygon","polyline","ellipse","text","tspan","use"]),!1),i(["area","audio","br","canvas","col","colgroup","embed","hr","iframe","map","object","param","source","track","video","wbr"]),!1),p=["button","reset","submit"],m=r(r([],i(p),!1),["file"],!1),N=["checkbox","color","radio","range"],w=r(r([],i(N),!1),["date","datetime-local","email","month","number","password","text","time","week"],!1),y=["tr","li","dt","dd"],L=r(["a","button","dl"],i(y),!1),_=["i","em","svg","img"],b=["i","span","em","b","strong","bdo"],x=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,E=/^([a-zA-Z\-\_0-9]+)$/,C="data-growing-ignore",k="data-growing-container",I="data-growing-index",T="data-growing-title",S=["circle-shape","circle-page","heatmap-page"],P=["__vconsole","__giokit"],M="DISPLAYED",O="OBSCURED",A="OUTSIDE",D={static:1,relative:2,sticky:3,absolute:4,fixed:5},j=function(e,t){var n;return null!==(n=a((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==n?n:a((function(){return e.hasOwnProperty(t)}))},W=function(e,t){var n;if(!e)return null;var i=null!==(n=a((function(){return e.getAttribute(t)})))&&void 0!==n?n:a((function(){var n,i;return null===(i=null===(n=e.attributes)||void 0===n?void 0:n.getNamedItem(t))||void 0===i?void 0:i.value}));return null!=i?i:null},H=function(e,t){var n;if(!(e instanceof HTMLElement||e instanceof Element))return!1;if(j(e,C))return!1;var o=null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase();if(!o||d(g,o))return!1;if(!d(["circleClick","circleHover","click"],t))return!0;if("textarea"===o&&"click"===t)return!1;if("input"===o){var a=W(e,"type");if("click"===t&&!d(m,a))return!1;if(d(["circleClick","circleHover"],t)&&!d(r(r([],i(m),!1),i(w),!1),a))return!1}return B(e)||!function(e){var t;if(!(null==e?void 0:e.children))return!1;if("svg"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase()))return!1;var n=e.children.length;if(0===n)return!1;for(var r=[],o=0;n>o;o++)r.push([e.children[o],1]);for(;r.length>0;){var a=i(r.shift(),2),s=a[0],u=a[1];if(u>5)return!0;var l=s.children.length;if(l>0&&u+1>5)return!0;for(o=0;l>o;o++)r.push([s.children[o],u+1])}return!1}(e)},X=function(e,t){if(void 0===t&&(t=!1),!(null==e?void 0:e.childNodes))return[];var n=t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE];return o(e.childNodes).filter((function(e){var t;if(!d(n,e.nodeType))return!1;if(e.nodeType===Node.TEXT_NODE)return!0;var i=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();return!!i&&!d(g,i)}))},G=function(e){return V(e.parentElement)?null:e.parentElement},V=function(e){var t;return!e||d(["body","html","#document"],null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())},B=function(e){if(!(null==e?void 0:e.tagName))return!1;var t=e.tagName.toLowerCase();return j(e,k)||d(L,t)||"input"===t&&d(p,e.type)},F=function(e){var t=X(e);return!h(t)&&t.every((function(e){var t,n=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();return!!n&&(d(_,n)||d(Array.from(e.classList),"icon"))&&!Z(e)}))},Z=function(e){var t=X(e,!0);return!h(t)&&t.every((function(e){var t;return(e.nodeType===Node.TEXT_NODE||d(b,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase()))&&!!R(e)}))},q=function(e){if("svg"===e.tagName)return!0;var t=X(e),n=Z(e);return h(t)||n},R=function(e){var t=X(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||d(b,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return z(e.textContent,e.textContent.length)}));return z(function(e){if(c(e)){for(var t=[],n=0;n<e.length;n++){var i=e[n];i&&!h(i)&&t.push(i)}return t}return e}(t).join(" "))},z=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,u(t)&&t>0?t:void 0):""},U=/[^/]*\.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,$=function(e,t){if(!t)return["",""];switch(t.toLowerCase()){case"a":return function(e){if(!j(e,"href"))return["",""];var t=W(e,"href");return!t||t.startsWith("javascript:")?["",""]:t.length>320?[t.slice(0,320),t]:[t,t]}(e);case"img":return function(e){var t,n=e.src;if(!n||n.includes("data:image"))return["",""];var i=n.match(U),r=null!==(t=null==i?void 0:i[0])&&void 0!==t?t:"";return r.includes("%")&&(r=r.substring(r.lastIndexOf("%")+3)),n.length>320?[n.slice(0,320),r]:[n,r]}(e);default:return["",""]}},K={a:function(e){var t=R(e);return t||(te(e)||$(e,"a")[0])},button:function(e){var t=W(e,"name");if(t)return t;var n=R(e);return n||(te(e)||ne(e))},img:function(e){return z(W(e,"alt"))||$(e,"img")[1]},input:function(e){if("password"===e.type)return"";var t,n,i=d(m,e.type),r=j(e,"data-growing-track");if(i||r)return z(e.value);if(d(N,e.type)){var a=void 0;return e.id&&(t=o(document.getElementsByTagName("label")),n=function(t){return t.htmlFor===e.id},a=t[function(e,t){var n=-1;if(c(e))for(var i=e.length-1,r=0;i>=r;r+=1)if(t(e[r]))return r;return n}(t,n)]),a||(a=ee(e,(function(e){var t;return"label"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())}))),ie(e,a?R(a):z(e.value))}return""},label:function(e){var t=R(e);return t||(te(e)||ne(e))},select:function(e){var t=o(e.options).filter((function(e){return e.selected}));if(t.length>0){var n=t.map((function(e){return e.hasAttribute("label")&&e.label&&e.label.trim()?e.label:e.textContent&&e.textContent.trim()?e.textContent.trim():e.value||""}));return z(n.join(", "))}return z(e.value)},svg:function(e){var t;return Array.from(e.childNodes).some((function(e){var n;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},Y=new WeakMap,J=function(e,t){var n=t.toLowerCase(),i=n in K?K[n]:void 0;if(!i&&Y.has(e))return Y.get(e);var r=W(e,T);if(j(e,T)&&r){var o=z(r);return Y.set(e,o),o}var a=W(e,"title");if(j(e,"title")&&a)return o=z(a),Y.set(e,o),o;if(i)return i(e);var s=R(e);return s?(o=z(s),Y.set(e,o),o):function(e){if("svg"===e.tagName)return!1;var t=X(e);return t.length>0&&t.every(q)}(e)&&!F(e)?(o=z(te(e)),Y.set(e,o),o):F(e)?(o=z(ne(e)),Y.set(e,o),o):(Y.set(e,""),"")},Q=new WeakMap,ee=function(e,t){if(Q.has(e))return Q.get(e);for(var n=e.parentElement;n&&!V(n);){if(t(n))return Q.set(e,n),n;var i=n.parentElement;if(!i)break;n=i}Q.set(e,void 0)},te=function(e){for(var t=X(e),n=[],i=0,r=t.length;r>i;i++){var o=t[i];if(Z(o)){var a=R(o);if(a&&(n.push(a),n.join(" ").length>100))break}}return n.join(" ").slice(0,100)},ne=function(e,t){var n;if(void 0===t&&(t=0),3>=t)for(var i=X(e),r=0,o=i.length;o>r;r++){var a=i[r],s=J(a,null===(n=a.tagName)||void 0===n?void 0:n.toLowerCase());if(s)return s;var u=ne(a,t+1);if(u)return u;if(r>5&&0===t)break}},ie=function(e,t){return d(["checkbox","radio"],e.type)?"".concat(t).concat(s(e.checked,"boolean")?"("+e.checked+")":""):t},re=function(){function e(t,a,s,u,l){void 0===u&&(u=!0),void 0===l&&(l=[]);var c,f,v,g=this;this.originNode=t,this.deviceInfo=a,this.actionType=s,this.isTrackable=u,this.parentNodes=l,this.isLimitViewport=!0,this._pureList=[],this._pseudoList=[],this._checkGioIndex=function(){var e=W(g.originNode,I);if(e){if(/^\d{1,10}$/.test(e)){var t=+e;if(t>0&&2147483647>t)return t}"string"==typeof g.actionType&&0>g.actionType.indexOf("circle")&&console.log("%c [GrowingIO]：".concat("".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！")),"color: #F59E0B;")}},this._getDlIndex=function(){var e,t,n,i=G(g.originNode);if(i&&i.tagName&&"dl"===i.tagName.toLowerCase()){var r=o(i.children).filter((function(e){return e.nodeType===Node.ELEMENT_NODE}));if(0!==r.length){var a=new Map,s=0;if(r.forEach((function(e){var t;"dt"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())&&a.set(e,++s)})),"dt"===(null===(e=g.originNode.tagName)||void 0===e?void 0:e.toLowerCase()))return a.get(g.originNode)||void 0;if("dd"!==(null===(t=g.originNode.tagName)||void 0===t?void 0:t.toLowerCase()));else for(var u=r.indexOf(g.originNode);u>=0;){var l=r[u];if("dt"===(null===(n=l.tagName)||void 0===n?void 0:n.toLowerCase()))return a.get(l)||void 0;u--}}}},this._getListIndex=function(e){var t=e.findIndex((function(e){return e.isSameNode(g.originNode)}));if(t>-1)return t+1},this._getIndex=function(){if(j(g.originNode,I))return g._checkGioIndex();if(g.tagName&&d(["dd","dt"],g.tagName.toLowerCase())){var e=g._getDlIndex();if(void 0!==e)return e}if(g.isPureList&&g._pureList){var t=g._getListIndex(g._pureList);if(void 0!==t)return t}if(g.isPseudoList&&g._pseudoList){var n=g._getListIndex(g._pseudoList);if(void 0!==n)return n}},this._isListNode=function(e){return e&&e.nodeType===Node.ELEMENT_NODE&&e.tagName&&y.includes(e.tagName.toLowerCase())},this._getIsPureList=function(){if(g._pureList=[],!g._isListNode(g.originNode))return!1;var e=g._getGlobalListNodes();if(e.length>=2)return g._pureList=e,!0;for(var t=[],n=g.originNode.previousElementSibling;n&&g._isListNode(n);)t.unshift(n),n=n.previousElementSibling;t.push(g.originNode);for(var i=g.originNode.nextElementSibling;i&&g._isListNode(i);)t.push(i),i=i.nextElementSibling;return g._pureList=t,t.length>=2},this._getGlobalListNodes=function(){var e,t;if(!g._findListContainer())return[];var i=g.originNode.parentElement;if(!i)return[];var r=i.querySelectorAll(":scope > ".concat(g.tagName)),o=[];try{for(var a=n(Array.from(r)),s=a.next();!s.done;s=a.next()){var u=s.value;g._isValidGlobalListItem(u)&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return o},this._findListContainer=function(){for(var e=g.originNode.parentElement;e&&!V(e);){if(j(e,k)||L.includes(e.tagName.toLowerCase()))return e;if(g._isLikelyListContainer(e))return e;e=e.parentElement}return null},this._isLikelyListContainer=function(e){var t,i,r,o,a=Array.from(e.children);if(2>a.length)return!1;var s=new Map;try{for(var u=n(a),l=u.next();!l.done;l=u.next()){var c=l.value.tagName.toLowerCase();s.set(c,(s.get(c)||0)+1)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}try{for(var d=n(s.values()),f=d.next();!f.done;f=d.next())if(f.value>=2)return!0}catch(e){r={error:e}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}return!1},this._isValidGlobalListItem=function(e){if(!g._isListNode(e))return!1;var t=g._getNodeDepth(g.originNode),n=g._getNodeDepth(e);return 2>=Math.abs(t-n)},this._getNodeDepth=function(e){for(var t=0,n=e.parentElement;n&&!V(n);)t++,n=n.parentElement;return t},this._getIsPseudoList=function(){var e=g._getSiblings(g.originNode);if(3>e.length)return!1;var t=g._findLongestUniformSequence(g.originNode,e);return t.length>=3&&(g._pseudoList=t.filter((function(e){return e instanceof Element})),g._pseudoList.length>=3)},this._getClassList=function(e){var t,i,r=W(e,"name");if(j(e,"name")&&r)return[r];var o=W(e,"class");if(!o)return[];var a=o.split(/\s+/);if(h(a))return[];var s=[];try{for(var u=n(a),l=u.next();!l.done;l=u.next()){var c=l.value;c&&!x.test(c)&&E.test(c)&&s.push(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}return s.sort()},this._getCurrentXpath=function(){var e=["/",g.tagName];return g.id&&e.push("#".concat(g.id)),g.classList.length&&e.push(".",g.classList.join(".")),e.join("")},this._getIsContainer=(f=new Set(L),v=new Set(p),function(){return!!j(g.originNode,k)||!!f.has(g.tagName)||!("input"!==g.tagName||!v.has(g.originNode.type))}),this._getIsOutFlow=function(){return d(["fixed","sticky"],window.getComputedStyle(g.originNode).position)},this._getRect=function(){var e=g.originNode.getBoundingClientRect(),t=window.devicePixelRatio||1,n=window.getComputedStyle(g.originNode).transform,i=n&&"none"!==n,r=Math.round(e.top*t)/t,o=Math.round(e.left*t)/t,a=Math.round(e.width*t)/t,s=Math.round(e.height*t)/t;i&&(a=g.originNode.offsetWidth,s=g.originNode.offsetHeight);var u=g.deviceInfo,l=u.winHeight,c=u.winWidth;return{top:r=Math.max(0,Math.min(r,l)),left:o=Math.max(0,Math.min(o,c)),width:a=Math.max(0,Math.min(a,c-o)),height:s=Math.max(0,Math.min(s,l-r))}},this._getListItemViewStatus=function(){var e=g.parentNodes.find((function(e){var t=e.originNode;return t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth}));if(!e)return"";if(!e.rect)return"";var t=e.rect,n=t.top,i=t.left,r=t.width,o=t.height,a=g.rect,s=a.top,u=a.left,l=i+r,c=n+o,d=u+a.width,f=s+a.height;return n>f||u>l||s>c||i>d?A:n>s||i>u||f>c||d>l?O:M},this._getViewStatus=function(e){var t,r,o,a,s=g,u=s.originNode,l=s.rect,c=s.isPureList,d=s.isPseudoList,f=s.isLimitViewport,h=l.top,v=l.left,p=l.width,m=l.height,N=g.deviceInfo,w=N.winWidth,y=N.winHeight,L=window.getComputedStyle(u);if(0===Number(L.opacity)||"hidden"===L.visibility||"none"===L.display||0===u.offsetWidth||0===u.offsetHeight)return"HIDDEN";try{for(var _=n(e),b=_.next();!b.done;b=_.next()){var x=b.value;if(x.isTrackable&&x.viewStatus===M)return x.viewStatus}}catch(e){t={error:e}}finally{try{b&&!b.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}if(c||d){var E=g._getListItemViewStatus();if(E)return E}if(!(y>h&&w>v&&p>0&&m>0))return A;var C=[[v+1,h+1],[v+p-1,h+1],[v+1,h+m-1],[v+p-1,h+m-1],[v+p/2,h+m/2]];try{for(var k=n(C),I=k.next();!I.done;I=k.next()){var T=i(I.value,2),S=T[0],P=T[1];if(document.elementFromPoint(S,P)===u)return M}}catch(e){o={error:e}}finally{try{I&&!I.done&&(a=k.return)&&a.call(k)}finally{if(o)throw o.error}}return f&&(0>h+m||0>v+p)?A:O},this._getTriggerEvent=function(){return"change"===g.actionType||"input"===g.tagName&&d(w,g.originNode.type)||d(["select","textarea"],g.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,n){if(n.length>0)return r([],i(n),!1);for(var o=[],a=t.parentElement;a&&!V(a);)o.push(a),a=a.parentElement;return o.map((function(t){if(e.xNodeCache.has(t))return e.xNodeCache.get(t);var n=new e(t,void 0,g.actionType,H(t,g.actionType),[]);return e.xNodeCache.set(t,n),n}))},this.tagName=(t.tagName||"").toLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=j(this.originNode,C),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=!this.isPureList&&this._getIsPseudoList(),this.peerNodes=this.isPureList?this._pureList:this.isPseudoList?this._pseudoList:[],this.index=this._getIndex();var m=$(t,this.tagName)[0];this.hyperlink=m||null,this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),a&&(this.isLimitViewport=null===(c=a.isLimitViewport)||void 0===c||c,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(l)),this.xParents=this._getXParents(t,l)}return Object.defineProperty(e.prototype,"content",{get:function(){return J(this.originNode,this.tagName)},enumerable:!1,configurable:!0}),e.prototype._findLongestUniformSequence=function(e,t){for(var n=[],i=[],r=!1,o=-1,a=0;a<t.length;a++){var s=t[a],u=!1;s===e?(u=!0,r=!0):u=this._compareNodes(e,s),u?0===i.length||o===a-1?(i.push(s),o=a):(this._updateMaxSequenceIfBetter(i,n,r),i=[s],r=s===e,o=a):(this._updateMaxSequenceIfBetter(i,n,r),i=[],r=!1,o=-1)}return this._updateMaxSequenceIfBetter(i,n,r),3>n.length?[]:n},e.prototype._updateMaxSequenceIfBetter=function(e,t,n){e.length>t.length&&n&&(t.length=0,t.push.apply(t,r([],i(e),!1)))},e.prototype._getSiblings=function(e){return e instanceof Element?e.parentNode?o(e.parentNode.children).filter((function(e){return e instanceof Element})):[e]:[]},e.prototype._compareNodes=function(e,t,n){var i,r;if(void 0===n&&(n=1),n>4)return!0;if(!(e instanceof Element&&t instanceof Element))return e===t;if(((null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase())||"")!==((null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase())||""))return!1;var a=this._getClassList(e),s=this._getClassList(t);if(!this._compareArrays(a,s))return!1;if(e.getAttribute("type")!==t.getAttribute("type"))return!1;var u=o(e.children),l=o(t.children);if(u.length!==l.length)return!1;for(var c=0;c<u.length;c++){var d=u[c],f=l[c];if(!this._compareNodes(d,f,n+1))return!1}return!0},e.prototype._compareArrays=function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))},e.xNodeCache=new WeakMap,e}(),oe=function(){function e(t,n,o,a,s){var l=this;this.origin=t,this.action=n,this.lengthThreshold=o,this.deviceInfo=a,this.parentNode=s,this.updateNodesIndex=function(e,t){e.length&&u(t)&&e.forEach((function(e){j(e.originNode,I)||(e.index=t)}))},this.trackNodes=function(){if(!l.isTrackable)return[];var e=[l.xNode];if(d(["click","circleClick"],l.actionType))for(var t=l._getParent();t;){var n=t.xNode;if(!n||n.isIgnored)return[];t.isTrackable&&e.push(n),t=t._getParent()}for(var i=[],r=0,o=0;o<e.length;o++){var a=e[o],s=0===o;if(j(a.originNode,k)){i.unshift(l.getGioNodeInfo(a)),l.updateNodesIndex(i,a.index);break}var u=a.isContainer||a.isPureList||a.isPseudoList;(s||u&&1>r)&&(i.unshift(l.getGioNodeInfo(a)),u&&(l.updateNodesIndex(i,a.index),s||r++))}return i},this.getGioNodeInfo=function(t){var n;if(e.nodeInfoCache.has(t))return e.nodeInfoCache.get(t);var i=l.computeXpath(t),r=i.skeleton,o={skeleton:r,xpath:r,fullXpath:i.fullXpath,xcontent:i.xcontent,hyperlink:t.hyperlink,index:t.index,peerNodes:null!==(n=t.peerNodes)&&void 0!==n?n:[],content:z(t.content),triggerEvent:t.triggerEvent,originNode:t.originNode};return e.nodeInfoCache.set(t,o),o},this.computeXpath=function(t){var n,o=e.xpathCache.get(t);if(o)return o;var a="/".concat(t.tagName),s=(t.id?"#".concat(t.id):"")+(h(t.classList)?"":".".concat(t.classList.join("."))),u=[a],c=["/".concat(s||"-")],d=[a+s];if(null===(n=t.xParents)||void 0===n?void 0:n.length){for(var f=[],v=[],g=0;g<t.xParents.length;g++){var p=t.xParents[g],m="/".concat(p.tagName),N=(p.id?"#".concat(p.id):"")+(h(p.classList)?"":".".concat(p.classList.join("."))),w=m+N;d.unshift(w),g<l.xpathThreshold-1&&(f.unshift(m),v.unshift("/".concat(N||"-")))}u.unshift.apply(u,r([],i(f),!1)),c.unshift.apply(c,r([],i(v),!1))}var y={skeleton:u.join(""),fullXpath:d.join(""),xcontent:c.join("")};return e.xpathCache.set(t,y),y},this._getParent=function(){var t=G(l.originElement);if((null==t?void 0:t.nodeName)&&!V(t)){if(e.parentCache.has(t)){var n=e.parentCache.get(t);if(n.originElement.id===t.id&&n.originElement.className===t.className)return n;e.parentCache.delete(t)}var i=new e(t,l.actionType);return e.parentCache.set(t,i),i}},this.actionType=d(["circleClick","circleHover","click","change"],n)?n:"click";var c=i(function(e,t){var n;if(void 0===t&&(t=20),!e)return[e,!1];for(var i=e,r=0,o=!1;i&&t>r;){r++;var a=null===(n=i.tagName)||void 0===n?void 0:n.toLowerCase();if(!a)break;if(!d(g,a)){if(d(b,a)){if(!i.childNodes.length)return[i,o];for(var s=!0,u=0;u<i.childNodes.length;u++){var l=i.childNodes[u];if(l.nodeType!==Node.COMMENT_NODE&&l.nodeType!==Node.TEXT_NODE){s=!1;break}}if(s){var c=G(i);if(c){i=c,o=!0;continue}}}return[i,o]}var f=G(i);if(!f)break;i=f}return[i,o]}(t),2),f=c[0],v=c[1];this.originElement=f,this.isUpgrade=v,this.xpathThreshold=u(o)?o:4,this.isTrackable=H(this.originElement,this.actionType),this.originElement.isSameNode(t)||(s=null);var p=[];s&&s.xNode&&(p.push(s.xNode),s.xNode.xParents&&p.push.apply(p,r([],i(s.xNode.xParents),!1))),this.xNode=new re(this.originElement,this.deviceInfo,this.actionType,this.isTrackable,p)}return e.nodeInfoCache=new WeakMap,e.xpathCache=new WeakMap,e.parentCache=new WeakMap,e}(),ae=function(){function e(n,o){var a,s,u,l,c,g,p,N=this;this.elements=[],this._processedNodes=new Set,this.trackNodes=function(e,t,n){return void 0===n&&(n=!1),N.elements=[],N._processedNodes.clear(),N._getTrackElements(e,t,null,n),N.elements},this._shouldProcessNode=function(e){var t;if(!(e instanceof HTMLElement||e instanceof Element))return!1;var n=null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase();if(!n)return!1;if(d(v,n))return!1;if(e.hasAttribute(C))return!1;if("input"===n){var o=e.getAttribute("type")||"text";return d(r(r([],i(m),!1),i(w),!1),o)}return!0},this._getTrackElements=function(e,t,n,i){void 0===i&&(i=!1),X(e).forEach((function(e){var r,o,a=null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase(),s=(null==e?void 0:e.id)||"";if(!(!a||S.includes(a)||P.some((function(e){return s.includes(e)}))||(null==(u=e)?void 0:u.tagName)&&d(_,u.tagName.toLowerCase()))){var u,l=!h(X(e));if(N._shouldProcessNode(e)||l){var c=new oe(e,function(e){var t,n;if("input"===(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())){var i=(null===(n=e.type)||void 0===n?void 0:n.toLowerCase())||"text";return w.includes(i)?"change":"click"}return"click"}(e),N.xpathThreshold,N.deviceInfo,n),f=c.xNode;if(f.zLevel=N._getZLevel(e,t),d([M,O],f.viewStatus)||i){var v=N._processedNodes.has(e);c.isTrackable&&!v&&(i||f.viewStatus===M||f.viewStatus===O&&f.isContainer)&&(N.elements.push(N._getGioHybridNodeInfo(c,t)),N._processedNodes.add(e)),(!f.isContainer||!Z(e))&&l&&N._getTrackElements(e,null!==(o=c.xNode)&&void 0!==o?o:t,c,i)}}}}))},this._getZLevel=function(t,n){var i=window.getComputedStyle(t),r=i.position,o=i.zIndex,a="auto"===o?0:parseInt(o,10)||0,s=(null==n?void 0:n.zLevel)||0;return 0!==a?s+a:s+e.getPositionZLevelIncrement(r)},this._scaleAndOffsetRect=function(e){var t={};return f(e).forEach((function(n){t[n]=e[n]*N.deviceInfo.scale})),t.top+=N.deviceInfo.webviewTop,t.left+=N.deviceInfo.webviewLeft,t},this._getGioHybridNodeInfo=function(e,n){var i=e.xNode,r=i.rect,o=i.zLevel,a=i.isPseudoList,s=i.isPureList,u=i.isContainer,l=i.isOutFlow,c=e.getGioNodeInfo(i),d=c.hyperlink,f=N._scaleAndOffsetRect(r);return t(t(t({},f),c),{zLevel:o+N.deviceInfo.webviewZLevel,href:d,parentXPath:(null==n?void 0:n.isTrackable)?e.computeXpath(n).fullXpath:void 0,isPseudoList:a,isPureList:s,isContainer:u,outFlow:l})},this.xpathThreshold=null!=o?o:4,this.deviceInfo=(s=(a=n).webviewLeft,u=a.webviewTop,l=a.webviewWidth,c=a.webviewHeight,g=a.webviewZLevel,p=a.isLimitViewport,{winWidth:l,winHeight:c,scale:l/window.innerWidth,webviewTop:u,webviewLeft:s,webviewWidth:l,webviewHeight:c,webviewZLevel:g,isLimitViewport:p})}return e.getPositionZLevelIncrement=function(e){return D[e]||1},e}();e.GioHybridNode=ae,e.GioWebNode=oe}));
//# sourceMappingURL=index.umd.js.map
